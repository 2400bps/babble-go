language: go

go:
- 1.11.x

before_install:
- go get github.com/onsi/gomega
- go get github.com/onsi/ginkgo/ginkgo
- go get github.com/golang/dep/cmd/dep
- go get golang.org/x/lint/golint
- go get github.com/loongy/covermerge
- go get github.com/mattn/goveralls
# - dep ensure

script:
- go vet ./...
# - golint -set_exit_status `go list ./... | grep -Ev "(stackint/asm|vendor)"`
# - golint `go list ./... | grep -Ev "(stackint/asm|vendor)"`
- ginkgo --cover --coverprofile coverprofile.out ./...
- covermerge core/addr/coverprofile.out adapter/rpc/coverprofile.out adapter/db/coverprofile.out > xoxo.coverprofile
- sed -i '/.pb.go/d' xoxo.coverprofile # autogenerated files
- sed -i '/marshal.go/d' xoxo.coverprofile

after_success:
- goveralls -coverprofile=xoxo.coverprofile -service=travis-ci -repotoken $COVERALLS_TOKEN